---
# yaml-language-server: $schema=https://schema.blue-build.org/module-list-v1.json

modules:
  - type: files
    files:
      - source: system
        destination: /

  - type: copy
    from: ironbar # rust
    src: /out/ironbar
    dest: /usr/bin/

  - type: copy
    from: matugen # rust
    src: /out/matugen
    dest: /usr/bin/

  - type: dnf
    repos:
      copr:
        - yalter/niri # packaged by the maintainer
        - atim/starship
        - lihaohong/yazi
        - varlad/zellij 
        - alebastr/sway-extras # swww seems up to date here
        - erikreider/SwayNotificationCenter
      files:
        - https://pkgs.tailscale.com/stable/fedora/tailscale.repo
        - charm.repo
      keys:
        - https://repo.charm.sh/yum/gpg.key
    install:
      packages:
        - https://github.com/raphamorim/rio/releases/download/v0.2.32/rioterm-0.2.32-1.x86_64_wayland.rpm

        # DE
        - niri # rust
        - polkit
        - mate-polkit
        - pavucontrol
        - rofi-wayland
        - xwayland-satellite
        - swww
        - nautilus
        - samba
        - gvfs-fuse
        - gvfs-smb
        - light
        - SwayNotificationCenter
        - gtk-layer-shell # Required for ironbar

        # - ibus # already provided by some package
        # - ibus-gtk3 # already provided by some package
        - ibus-mozc
        - ibus-panel

        # part of niri's weak dependencies
        # - xdg-desktop-portal-gtk
        # - xdg-desktop-portal-gnome
        # - gnome-keyring

        # Term emulator
        - kitty

        # editors
        - vim
        - helix # rust

        # term bling
        - btop 
        - starship # rust
        - fastfetch
        - lolcat
        - cava
        - cowsay
        - yazi # rust
        - zellij # rust
        - gum

        # Misc
        - tailscale
        - syncthing
        - rsync
        - luajit # lua jit compiler for ironbar Can remove this by disabling the feature during the build
        - solaar
        - davfs2 # to mount tailscale drive

        # dev
        - gcc
      exclude:
        - alacritty
        - waybar
        - waybar-git
        - fuzzel
        - mako
        - swaybg
    remove:
      packages:
        - htop
        - firefox

  - type: script
    scripts:
      - maplemono.nu

  - type: fonts
    fonts:
      nerd-fonts:
        - IBMPlexMono
        - FiraCode
      google-fonts:
        - Dancing Script
        - Pacifico
        - Lobster
        - Caveat
        - Twinkle Star

  - type: chezmoi
    repository: "https://github.com/benoitlx/dotfiles"
    wait-after-boot: "1m"

  - type: default-flatpaks
    configurations:
      - notify: true
        scope: system
        install:
          - org.mozilla.firefox
          - com.discordapp.Discord
          - org.videolan.VLC
          - org.mozilla.Thunderbird
          - com.rtosta.zapzap
          - com.synology.SynologyDrive
          - md.obsidian.Obsidian        
          - com.usebottles.bottles
          - com.logseq.Logseq
          - org.gnome.Snapshot
          - org.gnome.baobab
          - com.unicornsonlsd.finamp
          - com.github.iwalton3.jellyfin-media-player
          - com.github.tchx84.Flatseal
          - io.github.flattool.Warehouse
          - org.gnome.World.PikaBackup
          - com.protonvpn.www
          - com.belmoussaoui.Authenticator
          - org.gnome.Calculator
          - org.gnome.Papers
          - org.gnome.Loupe
          - org.gnome.Boxes
          - me.iepure.devtoolbox
          - org.gnome.clocks
          - org.openrgb.OpenRGB # udev rules are already included in base image

  # - type: akmods
  #   install:
  #     - xone

  # Copy custom justfiles
  - type: files
    files:
      - source: justfiles
        destination: /usr/share/ublue-os/just

  - type: systemd
    user:
      enabled:
        - niri.service
    system:
      enabled:
        - battery-charge-limit.service
        
  - type: signing
